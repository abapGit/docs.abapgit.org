import{_ as i}from"./plugin-vue_export-helper-c27b6911.js";import{r as c,o as l,c as r,a as n,b as e,d as a,w as s,e as o}from"./app-a38731d3.js";const d={},p=n("p",null,"This documentation covers page creation, HTML rendering, and event handling.",-1),u=o(`<h2 id="tl-dr" tabindex="-1"><a class="header-anchor" href="#tl-dr" aria-hidden="true">#</a> TL;DR</h2><ul><li>To create a new page in abapGit you subclass <code>ZCL_ABAPGIT_GUI_PAGE</code> and redefine <code>RENDER_CONTENT</code> method <em>(also consider separating components that implement <code>ZIF_ABAPGIT_GUI_RENDERABLE</code> directly, this will probably become the primary approach in future)</em></li><li>Use <code>ZCL_ABAPGIT_HTML</code> to collect HTML content - method <code>add</code> accepts strings, string_tables, and instances of <code>ZCL_ABAPGIT_HTML</code></li><li>Use <code>ZCL_ABAPGIT_HTML=&gt;ICON</code> to render icons</li><li>Use <code>ZCL_ABAPGIT_HTML=&gt;A</code> to render anchors, don&#39;t render them manually <code>&lt;a&gt;...&lt;/a&gt;</code></li><li>Please, please, care about usability, content readability, and style in general üôè üòâ</li><li>Check <code>ZCL_ABAPGIT_GUI_CHUNK_LIB</code> for some existing HTML chunks like <code>render_error</code></li><li>To register postponed HTML parts, scripts, and hotkeys - access corresponding methods via <code>gui_services</code> method of <code>zcl_abapgit_gui_component</code></li><li>See <code>zcl_abapgit_gui_page_template</code> as en example and template for new pages. Also see other page templates available in <code>test</code> sub-package. Follow the <code>TODO</code> comments in the template code.</li></ul><h2 id="gui-components" tabindex="-1"><a class="header-anchor" href="#gui-components" aria-hidden="true">#</a> GUI Components</h2><p>abapGit UI is based on HTML and <code>CL_GUI_HTML_VIEWER</code>. The main parts are:</p><ul><li><em>ZCL_ABAPGIT_GUI</em> - the class which initializes <code>CL_GUI_HTML_VIEWER</code> and manages page stack</li><li><em>ZCL_ABAPGIT_GUI_ASSET_MANAGER</em> - manages static assets like images, CSS, JS code, and fonts</li><li><em>ZCL_ABAPGIT_HTML</em> - helper for HTML accumulation and rendering</li><li><em>ZCL_ABAPGIT_GUI_ROUTER</em> - abapGit specific global event handling, main to route between the pages or run globally defined actions like repo installation</li><li><em>ZCL_ABAPGIT_GUI_PAGE</em> - base class for pages. It renders typical HTML headers and abapGit-related java scripts. ~So in most cases you probably just want to subclass it and render just the content~</li><li><em>ZCL_ABAPGIT_GUI_COMPONENT</em> - base class for GUI components. Gives access to <code>gui_services</code> to register postponed HTML parts, scripts, and hotkeys. Usually, it is a good idea to subclass from it, if you want to use these features.</li><li><em>ZIF_ABAPGIT_GUI_RENDERABLE</em> - interface which a renderable component must expose to be able to interact with <code>ZCL_ABAPGIT_GUI</code></li><li><em>ZIF_ABAPGIT_GUI_EVENT_HANDLER</em> - interface which a component must expose to be able to register itself as an event handler in <code>ZCL_ABAPGIT_GUI</code></li><li><em>ZIF_ABAPGIT_GUI_HOTKEYS</em> - interface which a component must expose to be able to register hotkey actions</li></ul><h2 id="rendering-content" tabindex="-1"><a class="header-anchor" href="#rendering-content" aria-hidden="true">#</a> Rendering Content</h2><p>An example of <code>RENDER_CONTENT</code> (or any other helper method with HTML output)</p><div class="language-abap line-numbers-mode" data-ext="abap"><pre class="language-abap"><code><span class="token keyword">METHOD</span> render_content<span class="token punctuation">.</span>

    <span class="token keyword">CREATE</span> <span class="token keyword">OBJECT</span> ro_html<span class="token punctuation">.</span>

    ro_html<span class="token token-operator punctuation">-&gt;</span>add<span class="token punctuation">(</span> <span class="token string">&#39;&lt;div&gt;&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>
    ro_html<span class="token token-operator punctuation">-&gt;</span>add<span class="token punctuation">(</span> <span class="token string">&#39;&lt;h1&gt;My content&lt;/h1&gt;&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>
    ro_html<span class="token token-operator punctuation">-&gt;</span>add_icon<span class="token punctuation">(</span> <span class="token string">&#39;star/error&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>
    ro_html<span class="token token-operator punctuation">-&gt;</span>add_a<span class="token punctuation">(</span>
        iv_txt <span class="token operator">=</span> <span class="token string">&#39;click me&#39;</span>
        iv_act <span class="token operator">=</span> <span class="token string">&#39;some_event_handled_in_abap&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>
    ro_html<span class="token token-operator punctuation">-&gt;</span>add<span class="token punctuation">(</span> render_some_complex_stuff<span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>
    ro_html<span class="token token-operator punctuation">-&gt;</span>add<span class="token punctuation">(</span> <span class="token string">&#39;&lt;/div&gt;&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token keyword">ENDMETHOD</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="html-helper" tabindex="-1"><a class="header-anchor" href="#html-helper" aria-hidden="true">#</a> HTML Helper</h3><p><code>ro_html</code> which is the instance of <code>ZCL_ABAPGIT_HTML</code> is a helper tool for HTML rendering. It accumulates HTML content and then can output it with <code>render</code> method. It has a couple of important methods:</p>`,10),h=n("li",null,[n("strong",null,"ADD"),e(" - adds a chunk to accumulated HTML. You can pass a string or another "),n("code",null,"ZCL_ABAPGIT_HTML"),e(" instance. In the example above "),n("code",null,"render_some_stuff"),e(" may either return a string or have the same pattern as "),n("code",null,"render_content"),e(" (retuning "),n("code",null,"ZCL_ABAPGIT_HTML"),e(" instance)")],-1),_=n("strong",null,"ADD_ICON and ICON",-1),m=n("code",null,"ZCL_ABAPGIT_HTML=>ICON",-1),k=o("<li><strong>ADD_A and A</strong> - render a link (anchor) (<code>A</code> - static method). It is strongly suggested that you use this method instead of rendering <code>&lt;a&gt;</code> tags directly. Params: <ul><li><code>IV_TXT</code> - text to be rendered inside the anchor</li><li><code>IV_TYP</code> - the type of action done on click. 3 options: <ul><li><code>zif_abapgit_html=&gt;c_action_type-url</code>- direct link to an URL,</li><li><code>...-sapevent</code> (the default) - pass an event to sap handler,</li><li><code>...-onclick</code> - call a JS function,</li><li><code>...-dummy</code> - just render an anchor but no action</li></ul></li><li><code>IV_ACT</code> - depending on the type should be either URL or sapevent name or JS function to call</li><li><code>IV_OPT</code> - <code>zif_abapgit_html=&gt;c_html_opt-strong</code> or <code>...-cancel</code> or <code>...-crossout</code> - some semantic predefined styles to add to the link</li><li><code>IV_CLASS</code> - additional CSS class, if needed</li><li><code>IV_STYLE</code> - additional direct styles to use (generally discouraged, please use CSS classes instead)</li><li><code>IV_ID</code> - id of the anchor (may be needed for JS code)</li></ul></li><li><strong>SET_TITLE</strong> - the method is used for debugging purposes for postponed HTML parts. As it is not visible which class registered an HTML part, the title can be used to specify the origin.</li>",2),g=o(`<h2 id="renderables" tabindex="-1"><a class="header-anchor" href="#renderables" aria-hidden="true">#</a> Renderables</h2><p>Sub-classing <code>ZCL_ABAPGIT_GUI_PAGE</code> is not the only way to render the content. You may want to separate some visual component that is not a page e.g. <code>ZCL_ABAPGIT_GUI_VIEW_REPO</code> is a class like that. In essence, you have to implement <code>ZIF_ABAPGIT_GUI_RENDERABLE</code> and its method - <code>render</code>. Then you can reuse it or even pass it directly to the GUI class as a page to render.</p><p>It makes sense to also subclass your component from <code>ZCL_ABAPGIT_GUI_COMPONENT</code>. This class has a protected <code>gui_services</code> method returning the singleton instance of <code>ZIF_ABAPGIT_GUI_SERVICES</code>. The GUI services are good for:</p><ul><li>registering self as an event handler (<code>register_event_handler</code>). Importantly, later registered event handlers have higher priority (processing is done from bottom to top)</li><li>accessing hotkey services (<code>get_hotkeys_ctl</code>) - to register own hotkeys for the page (hotkeys are combined from the whole component stack)</li><li>registering postponed HTML parts (<code>get_html_parts</code>)</li></ul><h2 id="postponed-html-parts" tabindex="-1"><a class="header-anchor" href="#postponed-html-parts" aria-hidden="true">#</a> Postponed HTML Parts</h2><p>Components may have postponed parts, e.g. scripts or hidden forms. These chunks may need to be rendered in another location on the page (e.g. scripts are rendered at the end). There is a mechanism to enable it:</p><div class="language-abap line-numbers-mode" data-ext="abap"><pre class="language-abap"><code>    <span class="token eol-comment comment">&quot; ... somewhere within render</span>
    gui_services<span class="token punctuation">(</span> <span class="token punctuation">)</span>-&gt;get_html_parts<span class="token punctuation">(</span> <span class="token punctuation">)</span>-&gt;add_part<span class="token punctuation">(</span>
      iv_collection <span class="token operator">=</span> c_html_parts<span class="token token-operator punctuation">-</span>scripts
      ii_part       <span class="token operator">=</span> render_my_scripts<span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>where <code>render_my_scripts( )</code> must return an instance of <code>ZCL_ABAPGIT_HTML</code>.</p><p>Currently, two collections are supported out of the box - scripts and hidden_forms (see definition of <code>zcl_abapgit_gui_component</code>). Scripts rendered after the page body. Hidden forms right before the end of the body. But this does not limit you to these categories only - you may register your own collections to exchange postponed parts between components supported by you. The collection is just a named list of <code>ZCL_ABAPGIT_HTML</code> instances.</p><h2 id="router-and-event-handlers" tabindex="-1"><a class="header-anchor" href="#router-and-event-handlers" aria-hidden="true">#</a> Router and Event Handlers</h2><p>To process sapevents in abap the component (page) must implement <code>ZIF_ABAPGIT_GUI_EVENT_HANDLER=&gt;on_event</code>. It imports <code>ii_event</code> instance which represents <code>sapevent</code> handler of <code>cl_gui_html_viewer</code>. In particular:</p><ul><li><code>ii_event-&gt;mv_action</code> - sapevent code (part of URL before <code>?</code>)</li><li><code>ii_event-&gt;mv_getdata</code> - raw URL query (part of URL after <code>?</code>)</li><li><code>ii_event-&gt;mt_postdata</code> - raw post data (if present)</li><li><code>ii_event-&gt;mi_gui_services</code> - the instance of GUI services for easier access</li><li><code>ii_event-&gt;query()</code> - returns parsed url query (<code>k1=v1&amp;k2=v2...</code>) in form of <code>string_map</code>. Param names are uppercased (by default). Params that are not uniform are not parsed (<code>k1=v1&amp;k2</code> - will result in <code>k1</code> only). Params can be addressed in 2 typical ways: <ul><li><code>ii_event-&gt;query( )-&gt;get( &#39;XXX&#39; )</code></li><li>or <code>ii_event-&gt;query( )-&gt;to_abap( changing cs_container = ls_struc_with_fields )</code></li><li>query string_map is immutable (attempt to <code>set</code> will raise an exception)</li><li>accepts optional <code>iv_upper_cased</code> param to unify param names (default = <code>true</code>)</li></ul></li><li><code>ii_event-&gt;form_data()</code> - attempts to parse post_data assuming it is set of key value pairs. Returns a string map. Otherwise behaves as <code>query()</code> above. <code>iv_upper_cased = false</code> by default.</li></ul><p>Events can be processed on 2 levels - in page/component <strong>or</strong> in the router. On new event:</p><ul><li>the GUI goes through the event handlers stack - a list of components that registered themselves as event handlers during rendering via <code>gui_services</code></li><li>the processing is done from the last registered handler to the first one (stack top to bottom)</li><li>the first event handler that returns &quot;handled&quot; status breaks the cycle (see below how this is indicated)</li><li>if the event was not handled by the handlers in the stack the event would be passed to the router</li></ul><p>Router (<code>ZCL_ABAPGIT_GUI_ROUTER</code>) is the class that handles global abapGit commands like opening specific pages and actions like repo installation/deletion.</p><p>In order to indicate the result of event handling an <code>on_event</code> implementation must return <code>rs_handled-state</code> (element of <code>zcl_abapgit_gui=&gt;c_event_state</code>) and, optionally, <code>rs_handled-page</code>:</p><ul><li><code>not_handled</code> (same as <code>initial</code>) - the event was not handled, process it by the next handler (e.g. the router)</li><li><code>re_render</code> - just re-render the current page (probably an internal state of the page object was changed so the visualization should too)</li><li><code>new_page</code> - render <code>ei_page</code></li><li><code>go_back</code> - render the previous page in the call stack (e.g. user pressed F3)<code>no_more_act</code> - the action was handled, no further processing required, and in particular <strong>no re-rendering</strong></li><li><code>new_page_w_bookmark</code> - <code>ei_page</code> and put a bookmark - allows using <code>go_back_to_bookmark</code> action that will skip all the page stack till the first bookmark</li><li><code>new_page_replacing</code> - <code>ei_page</code> and replace the current page in stack (so that F3 returns to the parent of the current page)</li><li><code>go_back_to_bookmark</code> - go back and skip all the page stack till the first bookmark (works with <code>new_page_w_bookmark</code>)</li></ul><h2 id="hotkey" tabindex="-1"><a class="header-anchor" href="#hotkey" aria-hidden="true">#</a> Hotkey</h2><p>In a nutshell:</p><div class="language-abap line-numbers-mode" data-ext="abap"><pre class="language-abap"><code>  <span class="token eol-comment comment">&quot; somewhere within render</span>
  gui_services<span class="token punctuation">(</span> <span class="token punctuation">)</span>-&gt;get_hotkeys_ctl<span class="token punctuation">(</span> <span class="token punctuation">)</span>-&gt;register_hotkeys<span class="token punctuation">(</span> me <span class="token punctuation">)</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>The component must implement <code>zif_abapgit_gui_hotkeys</code> and return the list of keys, their human-readable meaning, and the corresponding event to invoke.</p><div class="language-abap line-numbers-mode" data-ext="abap"><pre class="language-abap"><code>  <span class="token keyword">METHOD</span> zif_abapgit_gui_hotkeys<span class="token token-operator punctuation">~</span>get_hotkey_actions<span class="token punctuation">.</span>

    <span class="token keyword">DATA</span> ls_hotkey_action <span class="token keyword">LIKE</span> <span class="token keyword">LINE</span> <span class="token keyword">OF</span> rt_hotkey_actions<span class="token punctuation">.</span>

    ls_hotkey_action<span class="token token-operator punctuation">-</span>ui_component <span class="token operator">=</span> <span class="token string">&#39;Stage&#39;</span><span class="token punctuation">.</span> <span class="token eol-comment comment">&quot; &lt;&lt;&lt; This is to define origin of hotkeys</span>

    ls_hotkey_action<span class="token token-operator punctuation">-</span>description  <span class="token operator">=</span> <span class="token token-operator punctuation">|</span><span class="token string-template string">Patch</span><span class="token token-operator punctuation">|</span><span class="token punctuation">.</span> <span class="token eol-comment comment">&quot; &lt;&lt;&lt; Human readable description</span>
    ls_hotkey_action<span class="token token-operator punctuation">-</span>action       <span class="token operator">=</span> zif_abapgit_definitions<span class="token token-operator punctuation">=&gt;</span>c_action<span class="token token-operator punctuation">-</span>go_patch<span class="token punctuation">.</span> <span class="token eol-comment comment">&quot; &lt;&lt;&lt; abapgit-wide action to open patch page</span>
    ls_hotkey_action<span class="token token-operator punctuation">-</span>hotkey       <span class="token operator">=</span> <span class="token token-operator punctuation">|</span><span class="token string-template string">p</span><span class="token token-operator punctuation">|</span><span class="token punctuation">.</span>     <span class="token eol-comment comment">&quot; &lt;&lt;&lt; Key</span>
    <span class="token keyword">INSERT</span> ls_hotkey_action <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> rt_hotkey_actions<span class="token punctuation">.</span>

    ls_hotkey_action<span class="token token-operator punctuation">-</span>description  <span class="token operator">=</span> <span class="token token-operator punctuation">|</span><span class="token string-template string">Diff</span><span class="token token-operator punctuation">|</span><span class="token punctuation">.</span>
    ls_hotkey_action<span class="token token-operator punctuation">-</span>action       <span class="token operator">=</span> zif_abapgit_definitions<span class="token token-operator punctuation">=&gt;</span>c_action<span class="token token-operator punctuation">-</span>go_diff<span class="token punctuation">.</span>
    ls_hotkey_action<span class="token token-operator punctuation">-</span>hotkey       <span class="token operator">=</span> <span class="token token-operator punctuation">|</span><span class="token string-template string">d</span><span class="token token-operator punctuation">|</span><span class="token punctuation">.</span>
    <span class="token keyword">INSERT</span> ls_hotkey_action <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> rt_hotkey_actions<span class="token punctuation">.</span>

  <span class="token keyword">ENDMETHOD</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,22);function v(b,f){const t=c("RouterLink");return l(),r("div",null,[p,n("ul",null,[n("li",null,[e("See also "),a(t,{to:"/development-guide/user-interface/developing-ui-css.html"},{default:s(()=>[e("UI - CSS and Assets")]),_:1})]),n("li",null,[e("See also "),a(t,{to:"/development-guide/user-interface/developing-ui-js.html"},{default:s(()=>[e("UI - JavaScript")]),_:1})]),n("li",null,[e("See also "),a(t,{to:"/development-guide/user-interface/developing-ui-forms.html"},{default:s(()=>[e("HTML Forms")]),_:1})])]),u,n("ul",null,[h,n("li",null,[_,e(" - renders an icon. abapGit uses web fonts to render icons (see "),a(t,{to:"/development-guide/user-interface/adding-icons.html"},{default:s(()=>[e("adding icons")]),_:1}),e("). The method accepts the icon name and a CSS class name which represents a color separated by '/'. E.g., in the example above it will render 'star' icon and assign 'error' CSS class to it which has red color in the abapGit styles. The method has its static brother "),m,e(" which is more convenient in some cases and just returns a rendered HTML string.")]),k]),g])}const I=i(d,[["render",v],["__file","developing-ui.html.vue"]]);export{I as default};
